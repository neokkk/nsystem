# simple_switch

## LED 제어 코드 작성에 상태 머신 패턴을 사용합니다.

### LED 구성

- output 포트 8개
  - 왼쪽 그룹 (GPIO 17, 27, 22, 5)
  - 오른쪽 그룹 (GPIO 6, 26, 23, 24)

- input 포트 1개
  - GPIO 16

  위에서 아래로, 왼쪽에서 오른쪽으로 인덱스를 매기며, 비트 연산에서는 반대로(0번 인덱스가 LSB) 동작한다.

### 상태
이전 상태와 현재 입력에 따라 다음 상태가 정해진다.

* SW_OFF
  off 상태의 스위치를 의미한다.

  - on
    클릭이 시작되었다. 클릭 종류를 판별하기 위해 시작 시간을 기록한다.

  - off
    의미 없는 상태이다. 계속 루프를 돌면서 입력을 받는다.

* SW_ON
  on 상태의 스위치를 의미한다.
  
  - on
    계속 스위치가 눌려지고 있음을 의미한다. 짧은 클릭 시점이 지난 경우 타임아웃 처리한다.

  - off
    클릭이 종료되었다. 기존 상태가 타임아웃이 아니었으므로 짧은 클릭을 의미한다.
    LED를 제어하고 상태를 off로 변경한다.

* TM_OUT
  timeout 상태를 의미한다.
  LED를 제어하고 상태를 off로 변경한다.
  
### 액션

* 짧은 클릭
  입력 값이 0에서 1로 전환된 이후 1000ms 이내에 0으로 전환된다.
  왼쪽 LED 그룹이 켜진다.

* 긴 클릭
  입력 값이 0에서 1로 전환된 이후 1000ms를 넘겨 0으로 전환된다.
  오른쪽 LED 그룹이 켜진다.

* 더블 클릭


### 패턴

* 1. 짧은 클릭은 왼쪽 LED 그룹을 켜고, 긴 클릭은 오른쪽 LED 그룹을 켠다.
* 2. 짧은 클릭을 하면 왼쪽부터 차례로 LED가 켜진다.